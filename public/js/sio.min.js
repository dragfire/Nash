function getMsgs(e){var t=$("div#content"),n=document.querySelector(".msg-board");$.ajax({url:"/message",dataType:"json",data:{room:e},success:function(e){e.forEach(function(e){t.append("<div id='msg' class='card-panel'> <span class='pink-text accent-4 uname' style='font-weight: bold'>"+e.username+"</span> says: <h6 class='text' style='margin-left: 20px!important;'>"+e.content+"</h6> </div>")})},error:function(e,t,n){console.log(n.toString())}}),n.scrollTop=n.scrollHeight}$(function(){var e,t,n=io(),s=$("#rooms"),a=$("#username"),o=$("div#content"),l=$(".msg-content"),c=$("#typing"),i=document.querySelector(".msg-board"),r=$("#invite").val(),m=$("#privacy").val(),g=$("#room").val().trim();c.hide(),console.log(n),t=m||r?g:s.val(),n.emit("new user",{room:t,username:a.text()}),e=t,console.log(t),getMsgs(t),n.on("user joined",function(e){o.append('<h6 class="center-align black-text darken-4 shades-text">Just joined: <span class="light-green-text accent-4 big" style="font-weight: bold">'+e.username+"</span>. Welcome</h6>"),i.scrollTop=i.scrollHeight}),n.on("user left",function(e){o.append('<h6 class="center-align black-text darken-4 shades-text">Just left: <span class="light-green-text accent-4 big" style="font-weight: bold">'+e.username+"</span>. Bye Bye!!!</h6>"),i.scrollTop=i.scrollHeight}),n.on("setup",function(n){n.rooms;e=t}),s.change(function(){t=s.val(),console.log("username: ",a.text()),n.emit("switch room",{oldRoom:e,newRoom:t,username:a.text()}),e=t,o.empty(),getMsgs(t)}),n.on("message created",function(e){console.log("message created",e),e.username===a.text()?o.append("<div id='msg' class='card-panel'> <span class='teal-text accent-3 uname' style='font-weight: bold'>You [<span class='pink-text accent-4 uname' style='font-weight: bold'>"+e.username+"</span>]</span>: <h6 class='text' style='margin-left: 20px!important;'>"+e.content+"</h6> </div>"):o.append("<div id='msg' class='card-panel'> <span class='pink-text accent-4 uname' style='font-weight: bold'>"+e.username+"</span> says: <h6 class='text' style='margin-left: 20px!important;'>"+e.content+"</h6> </div>"),i.scrollTop=i.scrollHeight}),$(".send-btn").click(function(){console.log("send to",g),n.emit("new message",{message:l.val(),username:a.text(),room:t}),l.val("")}),l.keydown(function(){n.emit("user typing",{username:a.text(),room:t})}),l.blur(function(){console.log("stopped typing"),n.emit("stopped typing",{username:a.text(),room:t})}),n.on("typing",function(e){a.text()!=e.username&&(c.show(),c.find("span").css({color:"blue"}),c.find("span").text(e.username))}),n.on("no typing",function(e){c.hide()}),$(".ch-uname-btn").click(function(){var t=a.text(),s=$(".ch-uname").val();n.emit("change username",{oldUsername:t,username:s,room:e})}),n.on("username changed",function(e){o.append('<h6 class="center-align black-text darken-4 shades-text"> <span class="light-green-text accent-4 big" style="font-weight: bold">'+e.oldUsername+'</span> changed Username to: <span class="light-green-text accent-4 big" style="font-weight: bold">'+e.username+"</span> </h6>"),a.text()==e.oldUsername&&a.text(e.username),i.scrollTop=i.scrollHeight})});